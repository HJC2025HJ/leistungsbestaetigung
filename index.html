<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leistungsbestätigung</title>

<style>
*{box-sizing:border-box}
body{
margin:0;
padding:12px;
font-family:Arial,Helvetica,sans-serif;
background:#eef2f3;
}

.container{
max-width:1200px;
margin:auto;
background:#fff;
border-radius:14px;
padding:20px;
position:relative;
overflow:hidden;
}

/* ===== FILIGRANE ===== */
.watermark{
position:absolute;
inset:0;
background:url("HJ_Clean.png") center/70% no-repeat;
opacity:0.12;
pointer-events:none;
z-index:0;
}

/* ===== CONTENU ===== */
.content{position:relative;z-index:1}

.header{
display:flex;
gap:20px;
align-items:center;
flex-wrap:wrap;
}
.header img{max-width:140px}
.header .info{font-size:13px}

h1{text-align:center;margin:12px 0}

.section-title{
margin-top:18px;
font-weight:bold;
border-left:5px solid #22c55e;
padding-left:10px;
}

/* ===== GRILLES ===== */
.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:12px;
margin-top:10px;
}

.field label{
display:block;
font-size:13px;
margin-bottom:4px;
font-weight:600;
}

.field input,
.field select{
width:100%;
padding:9px;
border-radius:8px;
border:1px solid #ccc;
font-size:14px;
}

/* ===== EMPLOYÉS ===== */
.employee-list label{
display:flex;
align-items:center;
gap:8px;
margin:6px 0;
}

/* ===== HEURES ===== */
.time-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:16px;
margin-top:10px;
}
.time-box{
border:1px solid #ddd;
border-radius:10px;
padding:10px;
}
.time-row{
display:grid;
grid-template-columns:1fr 1fr;
gap:8px;
}

/* ===== SIGNATURE ===== */
.signatures{
display:grid;
grid-template-columns:1fr 1fr;
gap:16px;
margin-top:14px;
}
@media(max-width:700px){
.signatures{grid-template-columns:1fr}
}

.sig-box{
border:1px dashed #aaa;
border-radius:10px;
padding:10px;
}
canvas{
width:100%;
height:140px;
border:2px dashed #999;
border-radius:8px;
touch-action:none;
background:#fff;
}
.sig-actions{
margin-top:6px;
display:flex;
gap:8px;
}
button{
padding:9px 12px;
border:none;
border-radius:8px;
cursor:pointer;
color:#fff;
font-size:14px;
}
.confirm{background:#22c55e}
.delete{background:#ef4444}
.delete:disabled{
opacity:.5;
cursor:not-allowed;
}
.print{
margin-top:14px;
width:100%;
background:#2563eb;
font-size:15px;
}

/* ===== PRINT – 1 PAGE ===== */
@media print{
@page{
size:A4;
margin:8mm;
}
html,body{
width:210mm;
height:297mm;
overflow:hidden;
background:#fff;
}
.container{
width:100%;
padding:6mm;
border-radius:0;
page-break-inside:avoid;
}
button,.sig-actions{display:none!important}
.watermark{opacity:0.08}
}
</style>
</head>

<body>
<div class="container">
<div class="watermark"></div>

<div class="content">
<div class="header">
<img src="HJ_Clean.png" alt="Logo">
<div class="info">
<strong>Cleaning – Marke von HJ Corporate GbR</strong><br>
Stauseestraße 27b, 54317 Riveris<br>
Tel. +49 176 87898900 · info@hjcorporate.de
</div>
</div>

<h1>Leistungsbestätigung</h1>

<!-- MITARBEITER -->
<div class="section-title">Mitarbeiter</div>
<div class="employee-list">
<label><input type="checkbox" class="emp" onchange="calc()"> Hervé Mbarga</label>
<label><input type="checkbox" class="emp" onchange="calc()"> Jacky Massing</label>
</div>

<!-- KUNDE -->
<div class="section-title">Kunde</div>
<div class="grid">
<div class="field"><label>Vorname</label><input></div>
<div class="field"><label>Nachname</label><input></div>
<div class="field"><label>Telefon</label><input></div>
<div class="field"><label>Anschrift</label><input></div>
</div>

<!-- DATUM & ZEIT -->
<div class="section-title">Datum & Zeit</div>
<div class="grid">
<div class="field"><label>Datum</label><input type="date"></div>
</div>

<div class="time-grid">
<div class="time-box">
<strong>Beginn</strong>
<div class="time-row">
<div class="field"><label>Stunde</label><select id="sh" onchange="calc()"></select></div>
<div class="field"><label>Minute</label><select id="sm" onchange="calc()"></select></div>
</div>
</div>
<div class="time-box">
<strong>Ende</strong>
<div class="time-row">
<div class="field"><label>Stunde</label><select id="eh" onchange="calc()"></select></div>
<div class="field"><label>Minute</label><select id="em" onchange="calc()"></select></div>
</div>
</div>
</div>

<!-- BERECHNUNG -->
<div class="section-title">Berechnung</div>
<div class="grid">
<div class="field"><label>Anzahl Mitarbeiter</label><input id="anzahlMA" readonly></div>
<div class="field"><label>Arbeitsstunden</label><input id="stunden" readonly></div>
<div class="field"><label>€/Stunde</label><input id="preisStd" value="25" oninput="calc()"></div>
<div class="field"><label>Kilometer</label><input id="km" value="0" oninput="calc()"></div>
<div class="field"><label>€/km</label><input id="preisKm" value="0.30" oninput="calc()"></div>
<div class="field"><label>Gesamtbetrag €</label><input id="gesamt" readonly></div>
</div>

<!-- SIGNATURES -->
<div class="section-title">Unterschriften</div>
<div class="signatures">
<div class="sig-box">
<strong>Kunde</strong>
<canvas id="sigK"></canvas>
<div class="sig-actions">
<button id="confirmK" class="confirm">Bestätigen</button>
<button id="clearK" class="delete">Löschen</button>
</div>
</div>
<div class="sig-box">
<strong>Mitarbeiter</strong>
<canvas id="sigM"></canvas>
<div class="sig-actions">
<button id="confirmM" class="confirm">Bestätigen</button>
<button id="clearM" class="delete">Löschen</button>
</div>
</div>
</div>

<button class="print" onclick="window.print()">Als PDF speichern / drucken</button>
</div>
</div>

<script>
function fill(sel,max){
for(let i=0;i<=max;i++){
let o=document.createElement("option");
o.value=o.text=String(i).padStart(2,"0");
sel.appendChild(o);
}}
fill(sh,23);fill(eh,23);fill(sm,59);fill(em,59);

function calc(){
let start=(+sh.value*60)+(+sm.value);
let end=(+eh.value*60)+(+em.value);
let diff=end-start;
if(diff<0) diff+=1440;
let hours=diff/60;

let employees=document.querySelectorAll(".emp:checked").length;
anzahlMA.value=employees;

let priceHour=+preisStd.value||0;
let kmVal=+km.value||0;
let priceKm=+preisKm.value||0;

let total=(hours*employees*priceHour)+(kmVal*priceKm);

stunden.value=hours.toFixed(2);
gesamt.value=total.toFixed(2);
}

/* SIGNATURES – VERROUILLAGE TOTAL */
function signatureController(canvas,confirmBtn,clearBtn){
const ctx=canvas.getContext("2d");
let drawing=false,locked=false;

canvas.addEventListener("pointerdown",e=>{
if(locked) return;
drawing=true;
ctx.beginPath();
const r=canvas.getBoundingClientRect();
ctx.moveTo(e.clientX-r.left,e.clientY-r.top);
});
canvas.addEventListener("pointermove",e=>{
if(!drawing||locked) return;
const r=canvas.getBoundingClientRect();
ctx.lineWidth=2;
ctx.lineCap="round";
ctx.lineTo(e.clientX-r.left,e.clientY-r.top);
ctx.stroke();
});
canvas.addEventListener("pointerup",()=>{drawing=false;ctx.beginPath();});

confirmBtn.onclick=()=>{
locked=true;
canvas.style.pointerEvents="none";
clearBtn.disabled=true;
};
clearBtn.onclick=()=>{
if(locked) return;
ctx.clearRect(0,0,canvas.width,canvas.height);
};
}

signatureController(sigK,confirmK,clearK);
signatureController(sigM,confirmM,clearM);
</script>

</body>
</html>
