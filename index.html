<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Leistungsbestätigung – HJ Cleaning</title>

<style>
body{font-family:system-ui;background:#eef2f5;margin:0;padding:10px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:12px}
h1{text-align:center}
label{font-weight:600;margin-top:10px;display:block}
input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}
.signature-box{border:2px dashed #aaa;border-radius:10px;padding:10px;margin-top:10px}
canvas{width:100%;height:150px;border:1px solid #000}
button{padding:12px;border:none;border-radius:10px;font-size:16px;color:#fff}
.green{background:#16a34a}
.red{background:#dc2626}
.blue{background:#2563eb;width:100%}
@media print{button{display:none}}
</style>
</head>

<body>
<div class="container">

<h1>Leistungsbestätigung</h1>
<p>Nr: <b id="docNr"></b></p>

<label>Mitarbeiter</label>
<label><input type="checkbox" class="emp" value="Hervé Mbarga"> Hervé Mbarga</label>
<label><input type="checkbox" class="emp" value="Jacky Massing"> Jacky Massing</label>

<hr>

<label>Vorname</label><input id="vorname">
<label>Nachname</label><input id="nachname">
<label>Telefon</label><input id="telefon">

<hr>

<div class="row">
<div><label>Datum</label><input type="date" id="datum"></div>
<div><label>Start</label><input type="time" id="start"></div>
<div><label>Ende</label><input type="time" id="ende"></div>
</div>

<hr>

<div class="row">
<div><label>€ pro Stunde</label><input id="preis" type="number"></div>
<div><label>Kilometer</label><input id="km" type="number"></div>
<div><label>€ pro KM</label><input id="kmPreis" type="number"></div>
</div>

<div class="row">
<div><label>Anfahrtskosten</label><input id="fahrt" readonly></div>
<div><label>Arbeitsstunden</label><input id="stunden" readonly></div>
<div><label>Gesamt €</label><input id="total" readonly></div>
</div>

<hr>

<h3>Kunde</h3>
<div class="signature-box">
<canvas id="sigClient"></canvas>
<button class="green" onclick="confirmClient()">Bestätigen</button>
<button class="red" onclick="clearSig('sigClient')">Löschen</button>
<p id="clientInfo"></p>
</div>

<h3>Mitarbeiter</h3>
<div class="signature-box">
<canvas id="sigEmp"></canvas>
<button class="green" onclick="confirmEmp()">Bestätigen</button>
<button class="red" onclick="clearSig('sigEmp')">Löschen</button>
<p id="empInfo"></p>
</div>

<br>
<button class="blue" onclick="downloadPDF()">Als PDF speichern</button>

</div>

<script>
document.getElementById("docNr").innerText="LB-"+Date.now();

function calc(){
let s=document.getElementById("start").value;
let e=document.getElementById("ende").value;
if(s&&e){
let start=new Date("1970-01-01T"+s);
let end=new Date("1970-01-01T"+e);
let diff=(end-start)/3600000;
document.getElementById("stunden").value=diff.toFixed(2);
}
let km=document.getElementById("km").value;
let kmPreis=document.getElementById("kmPreis").value;
let fahrt=km*kmPreis||0;
document.getElementById("fahrt").value=fahrt.toFixed(2);

let preis=document.getElementById("preis").value;
let total=(diff*preis)+fahrt||0;
document.getElementById("total").value=total.toFixed(2);
}
document.querySelectorAll("input").forEach(i=>i.oninput=calc);

function enable(canvas){
let c=canvas.getContext("2d");let draw=false;
canvas.onpointerdown=()=>draw=true;
canvas.onpointerup=()=>{draw=false;c.beginPath();}
canvas.onpointermove=e=>{
if(!draw)return;
let r=canvas.getBoundingClientRect();
c.lineTo(e.clientX-r.left,e.clientY-r.top);
c.stroke();c.beginPath();
c.moveTo(e.clientX-r.left,e.clientY-r.top);
}
}
enable(sigClient); enable(sigEmp);

function clearSig(id){
let c=document.getElementById(id).getContext("2d");
c.clearRect(0,0,300,150);
}

function confirmClient(){
sigClient.style.pointerEvents="none";
clientInfo.innerText="Signé le "+new Date().toLocaleString();
}
function confirmEmp(){
sigEmp.style.pointerEvents="none";
let emps=[...document.querySelectorAll(".emp:checked")].map(e=>e.value).join(", ");
empInfo.innerText="Signé par "+emps+" le "+new Date().toLocaleString();
}

function downloadPDF(){
document.title="LB_"+nachname.value+"_"+vorname.value;
window.print();
}
</script>

</body>
</html>
